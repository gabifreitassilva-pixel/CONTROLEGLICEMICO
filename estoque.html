<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlicoGabi - Estoque</title>
    <style>
        :root { --primaria: #7e57ff; --lavanda: #f4f0ff; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        .container { display: flex; flex-direction: column; min-height: 100vh; padding-bottom: 30px; }
        .header { background: var(--primaria); color: white; padding: 25px; text-align: center; }
        .tabs { display: flex; background: var(--lavanda); margin: 10px 15px; border-radius: 12px; padding: 5px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; color: var(--primaria); font-size: 11px; cursor: pointer; }
        .tab-btn.active { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-radius: 8px; }
        .input-area { background: var(--lavanda); margin: 0 15px 15px; padding: 20px; border-radius: 20px; display: flex; flex-direction: column; gap: 10px; }
        table { width: 92%; margin: auto; border-collapse: collapse; background: white; }
        th { text-align: left; font-size: 10px; color: var(--primaria); padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .hidden { display: none; }
    </style>
</head>
<body>
<div class="container">
    <div class="header"><h1>Estoque</h1></div>
    <div class="tabs">
        <button id="btnEst" class="tab-btn active" onclick="toggle('estoque')">Saldo</button>
        <button id="btnCad" class="tab-btn" onclick="toggle('cadastro')">Entrada</button>
        <button id="btnHist" class="tab-btn" onclick="toggle('historico')">Histórico</button>
    </div>

    <div id="abaEstoque">
        <table>
            <thead><tr><th>Item</th><th>Qtd</th><th>Validade</th></tr></thead>
            <tbody id="corpoEstoque"></tbody>
        </table>
    </div>

    <div id="abaCadastro" class="input-area hidden">
        <label>Item</label><input type="text" id="nomeItem">
        <label>Qtd</label><input type="number" id="qtdItem">
        <label>Validade</label><input type="date" id="dataVenc">
        <button style="background:var(--primaria); color:white; border:none; padding:15px; border-radius:12px;" onclick="add()">Salvar</button>
    </div>

    <div id="abaHistorico" class="hidden">
        <table>
            <thead><tr><th>Data</th><th>Item</th><th>Qtd</th></tr></thead>
            <tbody id="corpoHistorico"></tbody>
        </table>
    </div>
</div>

<script>
    let estoque = JSON.parse(localStorage.getItem('gabi_estoque_v1') || '[]');
    let hist = JSON.parse(localStorage.getItem('gabi_hist_est') || '[]');

    function toggle(aba) {
        // Controla a visibilidade das seções
        document.getElementById('abaCadastro').classList.toggle('hidden', aba !== 'cadastro');
        document.getElementById('abaEstoque').classList.toggle('hidden', aba !== 'estoque');
        document.getElementById('abaHistorico').classList.toggle('hidden', aba !== 'historico');

        // Controla qual botão parece ativo
        document.getElementById('btnEst').classList.toggle('active', aba === 'estoque');
        document.getElementById('btnCad').classList.toggle('active', aba === 'cadastro');
        document.getElementById('btnHist').classList.toggle('active', aba === 'historico');

        if(aba === 'estoque') renderEst();
        if(aba === 'historico') renderHist();
    }

    function add() {
        const nome = document.getElementById('nomeItem').value.toUpperCase();
        const qtd = parseInt(document.getElementById('qtdItem').value);
        const venc = document.getElementById('dataVenc').value;
        
        if(!nome || !qtd || !venc) return alert("Preencha!");
        
        const idx = estoque.findIndex(i => i.nome === nome && i.venc === venc);
        if(idx !== -1) estoque[idx].qtd += qtd; else estoque.push({ nome, qtd, venc });
        
        hist.unshift({ data: new Date().toLocaleDateString('pt-BR'), nome, qtd });
        
        localStorage.setItem('gabi_estoque_v1', JSON.stringify(estoque));
        localStorage.setItem('gabi_hist_est', JSON.stringify(hist));
        
        // Limpa os campos após salvar
        document.getElementById('nomeItem').value = "";
        document.getElementById('qtdItem').value = "";
        document.getElementById('dataVenc').value = "";
        
        toggle('estoque');
    }

    function renderEst() {
        const corpo = document.getElementById('corpoEstoque');
        corpo.innerHTML = estoque.map(i => `<tr><td>${i.nome}</td><td>${i.qtd}</td><td>${i.venc.split('-').reverse().join('/')}</td></tr>`).join('');
    }

    function renderHist() {
        const corpo = document.getElementById('corpoHistorico');
        corpo.innerHTML = hist.map(i => `<tr><td>${i.data}</td><td>${i.nome}</td><td>+${i.qtd}</td></tr>`).join('');
    }

    // Inicializa a tela na aba de estoque ao carregar
    window.onload = () => renderEst();
</script>
</body>
</html>

